title Untitled

@startuml
title Real-time Voice-to-Text + AI Workflow

actor Client5173 as "Client (Port 5173)"
actor Client5174 as "Client (Port 5174)"
participant "Frontend\nWeb Speech API" as Frontend
participant "Fastify + WebSocket\nServer (Port 3000)" as WS
database Redis
participant "OpenAI API" as OpenAI

Client5173 -> Frontend : Click record button\nSpeak audio
Frontend -> Frontend : Convert audio to text\n(Web Speech API)
Frontend -> WS : Send text via WebSocket/HTTP

WS -> Redis : Add text to Redis stream
Redis -> Redis : Publish message to subscribers
Redis --> WS : Notify server of new message
WS -> WS : Broadcast message to all connected clients
WS -> Client5174 : Send text

WS -> OpenAI : Send text for clarification\n(OpenAI API)
OpenAI --> WS : Return AI-generated suggestions
WS -> Redis : Add AI response to Redis stream
Redis -> Redis : Publish AI response to different stream
Redis --> WS : Notify server of new AI message
WS -> WS : Broadcast AI response to all clients
WS -> Client5174 : Send AI-generated response

@enduml
